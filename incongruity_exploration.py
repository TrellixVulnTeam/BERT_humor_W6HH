#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Oct  7 13:25:31 2019

@author: mhasan8
"""

import pickle as pkl
import numpy as np
from scipy import spatial
import matplotlib.pyplot as plt

zero_vec=np.array([-0.9090267419815063, -0.31174230575561523, 0.29691147804260254, 0.8389580249786377, 0.4487493932247162, -0.306306391954422, 0.8928194642066956, 0.3710826635360718, -0.2454887330532074, -0.9996346831321716, -0.7610780000686646, 0.854205310344696, 0.9946600198745728, -0.7058277726173401, 0.945063054561615, -0.687775731086731, -0.7798322439193726, -0.41742050647735596, 0.4471265375614166, -0.9007065892219543, 0.8220245242118835, 0.9975686073303223, 0.35437390208244324, 0.2294774353504181, 0.2934362590312958, 0.980389416217804, -0.8512884378433228, 0.9780734181404114, 0.9599080681800842, 0.680437445640564, -0.8314555287361145, 0.27781248092651367, -0.9968655109405518, -0.10338503122329712, -0.6563795208930969, -0.9958176612854004, 0.34962791204452515, -0.8208743333816528, -0.14609234035015106, -0.1960405558347702, -0.9760947823524475, 0.4759025573730469, 0.9992559552192688, 0.9167906045913696, 0.6953232884407043, -0.014631201513111591, -0.9999984502792358, 0.15131577849388123, -0.901118814945221, 0.3129000663757324, 0.41930246353149414, 0.8144155144691467, -0.10943236947059631, 0.4357290267944336, 0.2539920508861542, -0.060549989342689514, 0.08536802232265472, 0.19306132197380066, -0.09572143107652664, -0.4569869637489319, -0.33302271366119385, 0.21040432155132294, -0.5025323033332825, -0.9539294838905334, 0.7764942646026611, -0.8012553453445435, -0.40652668476104736, -0.4453893303871155, 0.06647086888551712, -0.0927891731262207, 0.8211808800697327, 0.32069331407546997, 0.362423300743103, -0.8974356055259705, -0.6105882525444031, 0.10481614619493484, -0.34216731786727905, 1.0, -0.5474808812141418, -0.9969529509544373, 0.6021908521652222, -0.7631829977035522, 0.2569340467453003, 0.7957488894462585, -0.9477524161338806, -1.0, 0.4952256977558136, -0.16146539151668549, -0.9949861764907837, 0.22898904979228973, 0.7355403304100037, -0.20664694905281067, -0.47432002425193787, 0.29285144805908203, 0.6505637168884277, -0.6673328280448914, -0.38933882117271423, -0.3430921733379364, -0.3855499029159546, -0.47881972789764404, 0.10841737687587738, -0.1245340034365654, -0.1850731074810028, -0.04888126626610756, 0.24917946755886078, -0.22358521819114685, -0.7748985290527344, 0.13819760084152222, -0.32111644744873047, 0.48084884881973267, 0.1747102439403534, -0.27950069308280945, 0.49379944801330566, -0.9763391613960266, 0.48875224590301514, -0.06692720204591751, -0.9935042858123779, -0.37590011954307556, -0.9972162842750549, 0.8250080347061157, -0.33351483941078186, -0.16062816977500916, 0.9564854502677917, 0.2318219095468521, 0.24443307518959045, -0.22059480845928192, -0.63865065574646, -1.0, -0.6134913563728333, -0.5754455924034119, 0.5265212655067444, -0.5328152775764465, -0.9915648102760315, -0.9797719120979309, 0.3788801431655884, 0.9523194432258606, 0.18322964012622833, 0.9983476996421814, -0.3744613230228424, 0.976252019405365, 0.39868196845054626, -0.5286118388175964, 0.5323761701583862, -0.4371908903121948, 0.6310600638389587, 0.618479311466217, -0.8397987484931946, 0.16704061627388, -0.31785207986831665, 0.581545352935791, -0.4453760087490082, -0.4703165292739868, 0.27666279673576355, -0.9500548243522644, -0.1647934913635254, 0.9799332618713379, -0.5184550881385803, 0.5312386155128479, 0.8028014898300171, -0.38978806138038635, -0.6509733200073242, 0.8064538836479187, 0.7461514472961426, 0.24726946651935577, 0.26534783840179443, 0.1813119798898697, -0.8580924868583679, 0.42471739649772644, -0.8414811491966248, -0.27460357546806335, 0.3372800648212433, -0.47194623947143555, 0.1870386153459549, -0.9964655041694641, -0.4807302951812744, 0.46681907773017883, 0.9943382740020752, 0.8488908410072327, 0.04727908596396446, 0.6136754751205444, -0.0012569066602736712, 0.7278347611427307, -0.9749134182929993, 0.9940785765647888, -0.18828243017196655, -0.03782031312584877, -0.06568574905395508, -0.20642080903053284, -0.9182250499725342, -0.5636024475097656, 0.8762233853340149, -0.7580544352531433, -0.9593181014060974, -0.2966393828392029, -0.07970232516527176, -0.5432544946670532, -0.877816379070282, 0.9079474210739136, -0.23448055982589722, -0.19688814878463745, -0.22386032342910767, 0.9156596660614014, 0.9801536798477173, 0.8988749384880066, -0.07068654149770737, 0.6539912819862366, -0.9663269519805908, -0.7446796894073486, 0.15505823493003845, 0.24174699187278748, 0.3355512022972107, 0.9982583522796631, 0.2763197124004364, -0.24045340716838837, -0.8595899343490601, -0.9929622411727905, 0.06101803109049797, -0.9539521336555481, -0.1575489491224289, -0.5319356322288513, 0.40683960914611816, -0.24426211416721344, -0.6961907744407654, 0.33490219712257385, -0.9934214949607849, -0.8611316680908203, 0.41703441739082336, -0.1770576685667038, 0.3254419267177582, 0.027170510962605476, 0.7955465912818909, 0.4815393388271332, -0.4386226236820221, 0.8905041813850403, 0.8853787183761597, -0.582730770111084, -0.9531666040420532, 0.8757483959197998, -0.07983650267124176, 0.8605891466140747, -0.646739661693573, 0.9846524596214294, 0.5600661635398865, 0.8444839715957642, -0.9893458485603333, 0.564693033695221, -0.8577008247375488, 0.6082283854484558, -0.3912194073200226, -0.9563949108123779, -0.5995345711708069, 0.17914368212223053, 0.46820005774497986, 0.9649165272712708, -0.7817115187644958, 0.9979492425918579, -0.6899427771568298, -0.9868751764297485, -0.34976646304130554, 0.24122180044651031, -0.997239887714386, 0.8941633701324463, 0.2528168857097626, 0.5110951662063599, -0.46890008449554443, -0.5398110747337341, -0.9933620691299438, 0.9834369421005249, 0.28796303272247314, 0.9886422753334045, -0.2889547348022461, -0.9445223212242126, -0.5252041220664978, -0.9886407256126404, 0.15934842824935913, -0.12423045188188553, 0.6186236143112183, 0.05415399372577667, -0.9482857584953308, 0.5032661557197571, 0.6911811232566833, 0.5235943794250488, 0.4371994435787201, 0.9973965287208557, 0.9999916553497314, 0.9878677725791931, 0.8817899227142334, 0.8126692771911621, -0.9953765273094177, -0.21841172873973846, 0.9994663000106812, -0.9728864431381226, -0.9999999403953552, -0.9502741694450378, -0.595931887626648, 0.6411958932876587, -1.0, -0.226944699883461, -0.1700439751148224, -0.9763265252113342, -0.14015202224254608, 0.992967963218689, 0.9943175911903381, -1.0, 0.878839373588562, 0.9759867787361145, -0.35242632031440735, 0.9007564187049866, -0.3355855643749237, 0.9933189153671265, 0.3941003978252411, 0.4431494176387787, -0.12891383469104767, 0.329502671957016, -0.31567585468292236, -0.8525518774986267, -0.14852707087993622, -0.23329170048236847, 0.9101024866104126, 0.2713075280189514, -0.6711406707763672, -0.9216719269752502, 0.4747985899448395, -0.42787572741508484, 0.09651531279087067, -0.9769520163536072, -0.10909464210271835, 0.6497178077697754, 0.8300060033798218, 0.15852883458137512, 0.12497012317180634, -0.8294187188148499, 0.30276694893836975, -0.7701593637466431, 0.16470347344875336, 0.370233416557312, -0.8392766714096069, -0.8269391059875488, -0.9266570210456848, 0.2409985214471817, 0.4170825779438019, -0.953778862953186, 0.9658223986625671, -0.06891521066427231, 0.8605316877365112, 1.0, 0.5892740488052368, -0.9404135346412659, 0.5870953798294067, 0.3471600115299225, -0.798754096031189, 1.0, 0.6772080659866333, -0.9931672215461731, -0.11832941323518753, -0.1316707283258438, -0.37272971868515015, -0.43452680110931396, 0.996098518371582, -0.2955958843231201, 0.28374573588371277, -0.2974475920200348, 0.9961020946502686, -0.9971276521682739, 0.7091110348701477, -0.8844336271286011, -0.9898208975791931, 0.9758726358413696, 0.9881702065467834, -0.20107199251651764, -0.6921728253364563, 0.12480556964874268, 0.7996802926063538, 0.5177290439605713, -0.9021398425102234, 0.8431490063667297, 0.7906578183174133, -0.3386519253253937, 0.9404322504997253, -0.8724003434181213, -0.015170639380812645, 0.217874675989151, -0.013676416128873825, -0.2616669833660126, 0.386572003364563, 0.4070422053337097, -0.30780020356178284, 0.024733522906899452, -0.2609129250049591, -0.49693354964256287, -0.946929395198822, 0.3404575288295746, 1.0, -0.4344389736652374, 0.6455893516540527, 0.5449522137641907, -0.012862199917435646, 0.07913156598806381, 0.32841548323631287, 0.3595349192619324, -0.40707817673683167, -0.6766142249107361, 0.7124497890472412, -0.9420602321624756, -0.9942494630813599, 0.8677235841751099, 0.03049476444721222, -0.12307721376419067, 0.9999457597732544, 0.335300475358963, 0.27468636631965637, 0.22191929817199707, 0.9562978148460388, -0.1820269227027893, -0.0906478688120842, -0.5122248530387878, 0.9925181865692139, -0.32052966952323914, 0.18260814249515533, 0.9096574783325195, -0.02965802140533924, -0.49525418877601624, -0.5252498388290405, 0.20219069719314575, -0.9538499116897583, -0.09589344263076782, -0.980480432510376, 0.9884622097015381, 0.6834951639175415, 0.443847119808197, 0.1448250114917755, 0.6128945350646973, 1.0, -0.7517592310905457, 0.7886301875114441, -0.8212167024612427, 0.8777655959129333, -0.9572734236717224, -0.7239798903465271, -0.19641923904418945, -0.025659291073679924, 0.44484126567840576, -0.2989589273929596, 0.442573219537735, -0.9889861345291138, -0.2765805423259735, 0.5764487385749817, -0.9759624004364014, -0.9956391453742981, 0.215794637799263, 0.7397050261497498, 0.16834914684295654, -0.9628673791885376, -0.7278012633323669, -0.7920515537261963, 0.801982045173645, -0.3841494917869568, -0.9835836291313171, 0.5910406708717346, -0.2969358265399933, 0.5416939854621887, -0.41735899448394775, 0.39853954315185547, -0.7927054166793823, 0.9721700549125671, 0.06519009172916412, -0.241038978099823, -0.3384239375591278, -0.9264957308769226, 0.9013552069664001, -0.7862768173217773, -0.8438203930854797, -0.02163151651620865, 1.0, -0.4120659828186035, 0.2481268048286438, 0.8126131892204285, 0.775473415851593, -0.23791435360908508, 0.15160052478313446, -0.003157754195854068, 0.3811468482017517, 0.8888554573059082, -0.6264278292655945, -0.9096639156341553, -0.17133666574954987, 0.101333387196064, 0.35627156496047974, -0.9187188148498535, 0.9099280834197998, 0.3654722273349762, 0.34840553998947144, -0.012185920029878616, 0.16893261671066284, 0.9983325004577637, -0.36887556314468384, -0.08038149774074554, -0.2962133288383484, -0.284121572971344, -0.2349260300397873, -0.5527689456939697, 1.0, 0.20317521691322327, 0.2780793309211731, -0.9979673624038696, -0.6361088156700134, -0.9421972036361694, 0.9999839663505554, 0.9600173830986023, -0.764043927192688, 0.640474796295166, 0.5748423337936401, 0.08932279795408249, 0.8220595121383667, -0.34959831833839417, -0.17635327577590942, 0.22803710401058197, 0.2391699105501175, 0.9829419851303101, -0.535426139831543, -0.9961864948272705, -0.702414870262146, 0.5683609247207642, -0.9524150490760803, 0.9937839508056641, -0.37874481081962585, 0.026160649955272675, -0.1765822023153305, -0.5259297490119934, 0.9387906193733215, 0.13041722774505615, -0.9881191253662109, -0.35935187339782715, 0.48911359906196594, 0.9953765273094177, 0.2740381360054016, -0.22643834352493286, -0.973883330821991, 0.3490390479564667, 0.5337768793106079, -0.5658443570137024, -0.9819217920303345, 0.9935008883476257, -0.9728561043739319, 0.5695219039916992, 0.9999998807907104, 0.18995054066181183, 0.3106496334075928, 0.1805451363325119, -0.35464340448379517, 0.287262886762619, -0.6720299124717712, 0.7254685163497925, -0.9792137145996094, -0.15561693906784058, 0.09843321889638901, 0.35858502984046936, -0.17051158845424652, -0.1306225061416626, 0.88310307264328, 0.12063241004943848, -0.10066860169172287, -0.3477349877357483, -0.2956600487232208, 0.4180257320404053, 0.9011742472648621, 0.0020560016855597496, -0.16091172397136688, 0.3242242932319641, -0.06053967401385307, -0.9554830193519592, -0.3698484003543854, -0.26699066162109375, -0.9991883039474487, 0.6263353228569031, -1.0, 0.3846128582954407, -0.8538604974746704, -0.1845047026872635, 0.9279773235321045, 0.3676321506500244, 0.0692753717303276, -0.9178755879402161, 0.28601378202438354, 0.8725284337997437, 0.8501115441322327, -0.5429409146308899, -0.6558814644813538, -0.904902458190918, 0.3390664756298065, -0.13661634922027588, 0.3165503442287445, -0.16595545411109924, 0.43061020970344543, -0.23305487632751465, 1.0, -0.03853873163461685, -0.5113941431045532, -0.9772207736968994, 0.017812930047512054, -0.29188284277915955, 0.999997079372406, -0.9238733053207397, -0.9894009232521057, 0.17259807884693146, -0.687400221824646, -0.8830195665359497, 0.3135710060596466, 0.16523343324661255, -0.7647080421447754, -0.895328164100647, 0.924098014831543, 0.8005700707435608, -0.28177401423454285, 0.59194415807724, -0.3206052780151367, -0.2924666106700897, 0.18297548592090607, 0.5212435722351074, 0.998023271560669, 0.46717798709869385, 0.9407898187637329, 0.19348837435245514, -0.3248828053474426, 0.9709562063217163, 0.18354660272598267, 0.8747844696044922, 0.137874573469162, 0.9999999403953552, 0.2838650941848755, -0.9503286480903625, -0.589767336845398, -0.9684556722640991, -0.23096174001693726, -0.9386751055717468, 0.1237061470746994, 0.2089689075946808, 0.9604967832565308, -0.47492098808288574, 0.9937048554420471, -0.586970865726471, 0.10337822139263153, -0.7564101815223694, 0.23844727873802185, 0.18363496661186218, -0.9783219695091248, -0.9939514398574829, -0.9976826906204224, 0.6538007855415344, -0.2679435610771179, -0.08547694981098175, 0.2573976218700409, 0.1486949473619461, 0.4017782509326935, 0.31454867124557495, -0.9999998807907104, 0.953702986240387, 0.4798775613307953, -0.677474319934845, 0.9917694330215454, 0.4734952449798584, 0.6986042857170105, 0.31117284297943115, -0.9956933856010437, -0.9919530749320984, -0.1548813283443451, -0.2802685499191284, 0.8592038750648499, 0.6486082077026367, 0.8102806210517883, 0.4377518594264984, -0.2941042184829712, -0.3721323311328888, -0.21013610064983368, -0.24198119342327118, -0.9980151057243347, 0.5445815324783325, 0.5331594347953796, -0.9651337265968323, 0.9722411632537842, -0.9039556384086609, -0.08091224730014801, 0.838154137134552, -0.2374013066291809, 0.9644205570220947, 0.543968141078949, 0.8369321227073669, 0.08574510365724564, 0.7919245958328247, 0.9765403270721436, 0.9300620555877686, 0.996423065662384, 0.2298225462436676, 0.698957085609436, -0.2344919890165329, 0.5045486688613892, 0.8071462512016296, -0.9617336988449097, 0.21583276987075806, 0.5977567434310913, -0.024387499317526817, 0.2791427671909332, -0.36596837639808655, -0.9118483662605286, 0.8213521838188171, -0.20869988203048706, 0.764870285987854, -0.0967455580830574, -0.16713078320026398, -0.47181686758995056, -0.30083560943603516, -0.7832003831863403, -0.7985182404518127, 0.321181982755661, 0.5864531397819519, 0.9706065058708191, 0.5302110910415649, -0.20003165304660797, -0.8595156669616699, -0.290253609418869, 0.8658471703529358, -0.9678871035575867, 0.9442771673202515, -0.26760783791542053, 0.9530684947967529, 0.37712547183036804, 0.21800382435321808, 0.714958131313324, -0.3080642819404602, -0.3103317618370056, -0.18720945715904236, -0.837579071521759, 0.8523528575897217, -0.3432145416736603, -0.6020252704620361, -0.716197669506073, 0.8211218118667603, 0.43350285291671753, 0.999631404876709, 0.578728199005127, -0.08373494446277618, -0.678013026714325, -0.322597861289978, 0.2160697877407074, -0.5976623296737671, -0.9999999403953552, 0.23044715821743011, -0.14740867912769318, -0.10729139298200607, -0.8459581732749939, 0.30718275904655457, -0.5761204361915588, -0.9779906272888184, -0.2395787537097931, 0.29961472749710083, 0.3649286925792694, -0.27557045221328735, -0.7856712341308594, 0.1311759203672409, 0.09934597462415695, 0.9568241238594055, 0.9449830055236816, -0.7219032645225525, 0.9289100170135498, 0.3842931389808655, -0.0024726339615881443, -0.3180219531059265, 0.9124107956886292])

# def get_context_summary(inst):
    
#     context=[]
#     for ct in inst['cls_embedding'][:5]:
#         if not np.array_equal(ct,zero_vec):
#             context.append(ct)
    
#     context=np.array(context)
    
#     summary=zero_vec
#     if len(context)>0:
#         summary=np.mean(context,axis=0)
    
#     return summary


def get_filtered_context(inst):
    
    context=[]
    for ct in inst['cls_embedding'][:5]:
        if not np.array_equal(ct,zero_vec):
            context.append(ct)
    
    context=np.array(context)
    
    return context    
    
    

dev_data=pkl.load(open("humor_bert_embeddings_dev.pkl","rb"))
train_data=pkl.load(open("humor_bert_embeddings_train.pkl","rb"))
test_data=pkl.load(open("humor_bert_embeddings_test.pkl","rb"))

humor_dist,nonhumor_dist=[],[]

for i,inst in enumerate(dev_data):
    
    context_summary=get_context_summary(inst)
    punchline_emb = inst['cls_embedding'][-1]      
    cos_dist=spatial.distance.cosine(punchline_emb,context_summary)
    
    if inst['label']==1:
        humor_dist.append(cos_dist)
    else:
        nonhumor_dist.append(cos_dist)

for i,inst in enumerate(test_data):
    
    context_summary=get_context_summary(inst)
    punchline_emb = inst['cls_embedding'][-1]      
    cos_dist=spatial.distance.cosine(punchline_emb,context_summary)
    
    if inst['label']==1:
        humor_dist.append(cos_dist)
    else:
        nonhumor_dist.append(cos_dist)        


for i,inst in enumerate(train_data):
    
    context_summary=get_context_summary(inst)
    punchline_emb = inst['cls_embedding'][-1]      
    cos_dist=spatial.distance.cosine(punchline_emb,context_summary)
    
    if inst['label']==1:
        humor_dist.append(cos_dist)
    else:
        nonhumor_dist.append(cos_dist) 
        
print("humor:")
print("mean",np.mean(humor_dist))
print("std",np.std(humor_dist))

print("non humor:")
print("mean",np.mean(nonhumor_dist))
print("std",np.std(nonhumor_dist))        

data_to_plot=[humor_dist,nonhumor_dist]

fig = plt.figure(1,figsize=(9,6))

ax=fig.add_subplot(111)

bp=ax.boxplot(data_to_plot)

plt.show()